################################################################################
# VaultMesh Peer Registry
# Central source-of-truth for all mesh nodes and their capabilities
#
# This file defines:
# - Node identity and network addresses
# - Role classification (hot/cold, criticality)
# - DNS names and aliases
# - Capability flags
# - Status and health tracking
#
# Format: KEY=VALUE with bash-compatible syntax
# Used by: mesh-daemon, bootstrap scripts, health checks, DNS configs
#
# Version: 2.0 (with BETA cold-node support)
# Last Updated: 2025-11-28
################################################################################

################################################################################
# MESH IDENTITY
################################################################################

MESH_DOMAIN="mesh"
MESH_TLD=".mesh"
MESH_VERSION="2.0"
MESH_CREATED="2025-11-28T00:00:00Z"
MESH_OPERATOR="sovereign"

# Root node (provides DNS, PKI, registry)
MESH_ROOT="gamma"
MESH_ROOT_IP="192.168.0.191"
MESH_ROOT_USER="sovereign"

################################################################################
# HOT NODES (Always-on, provide authoritative services)
################################################################################

# ============================================================================
# NODE: GAMMA (Primary Root Node)
# Role: DNS Authority, PKI, Mesh Coordinator, Operator Terminal
# Status: CRITICAL - Mesh cannot function without GAMMA
# ============================================================================

GAMMA_ENABLED=true
GAMMA_CLASS="hot"
GAMMA_CRITICALITY="critical"
GAMMA_ROLE="root,dns-authority,pki-master,mesh-daemon,coordinator"
GAMMA_TYPE="root-node"

# Network Configuration
GAMMA_HOSTNAME="gamma"
GAMMA_DOMAIN="gamma.mesh"
GAMMA_IP_LAN="192.168.0.191"
GAMMA_IP_TAILSCALE="100.64.0.1"  # TBD: check tailscale status
GAMMA_PORT_SSH=22
GAMMA_PORT_DNS=53
GAMMA_PORT_MESH=16160  # mesh-daemon listening port

# Aliases
GAMMA_ALIASES="gamma.local,gamma.tailscale,gamma.mesh,alpha"

# User & Auth
GAMMA_USER="sovereign"
GAMMA_SSH_KEY="~/.ssh/id_ed25519_github"

# Services Running
GAMMA_SERVICES="dnsmasq,mesh-daemon,ssh,wireguard,ntp"
GAMMA_PROVIDES="dns-resolution,pki-operations,peer-registry,mesh-coordination"
GAMMA_REQUIRES="none"

# Health Check
GAMMA_HEALTH_CHECK="ping,ssh-connect,dns-query,mesh-ping"
GAMMA_HEALTH_TIMEOUT=30

# Backup/Failover
GAMMA_BACKUP="none"
GAMMA_FAILOVER_TARGET="none"  # CRITICAL: no substitute
GAMMA_FAILOVER_TIME_CRITICAL="5min"

# Permissions
GAMMA_CAN_SERVE_DNS=true
GAMMA_CAN_SIGN_CERTS=true
GAMMA_CAN_MANAGE_PEERS=true
GAMMA_CAN_COORDINATE_MESH=true

# Tags
GAMMA_TAGS="primary,root-of-trust,gateway,coordinator,always-on"

################################################################################

# ============================================================================
# NODE: BRICK (Local Compute & CI/CD)
# Role: GitLab Runners, Heavy Compute, Backup Operator Terminal
# Status: HIGH - Required for CI/CD, mesh survives without it
# ============================================================================

BRICK_ENABLED=true
BRICK_CLASS="hot"
BRICK_CRITICALITY="high"
BRICK_ROLE="compute,runners,cicd,portal-ext,dev-plane,backup-operator"
BRICK_TYPE="compute-node"

# Network Configuration
BRICK_HOSTNAME="brick"
BRICK_DOMAIN="brick.mesh"
BRICK_IP_LAN="192.168.0.120"
BRICK_IP_TAILSCALE="100.64.0.2"  # TBD
BRICK_PORT_SSH=22
BRICK_PORT_RUNNER=8844  # gitlab-runner API

# Aliases
BRICK_ALIASES="brick.local,brick.mesh,beta"  # 'beta' is legacy

# User & Auth
BRICK_USER="sovereign"
BRICK_SSH_KEY="~/.ssh/id_ed25519_github"

# Services Running
BRICK_SERVICES="gitlab-runner,mesh-agent,ssh,dnsmasq-forwarder"
BRICK_PROVIDES="compute,ci-jobs,portal-ext,dev-builds"
BRICK_REQUIRES="dns-from-gamma,pki-from-gamma,mesh-coordination-from-gamma"

# DNS Configuration
BRICK_DNS_MODE="forwarder"  # forwards to GAMMA
BRICK_DNS_UPSTREAM="192.168.0.191:53"
BRICK_DNS_SERVES=false  # does NOT serve authoritative DNS

# Health Check
BRICK_HEALTH_CHECK="ping,ssh-connect,runner-health"
BRICK_HEALTH_TIMEOUT=30

# Backup/Failover
BRICK_BACKUP="to-bunker-de"
BRICK_FAILOVER_TARGET="akash-nodes"
BRICK_FAILOVER_TIME_CRITICAL="1h"

# Permissions
BRICK_CAN_SERVE_DNS=false
BRICK_CAN_SIGN_CERTS=false
BRICK_CAN_MANAGE_PEERS=false
BRICK_CAN_COORDINATE_MESH=false

# Tags
BRICK_TAGS="compute,runners,hot,always-on,dev-plane"

################################################################################

# ============================================================================
# NODE: BUNKER-DE (Cloud Vault & OffSec)
# Role: Receipts Vault, OffSec Operations, API Gateway
# Status: HIGH - Responsible for data persistence and OffSec
# ============================================================================

BUNKER_DE_ENABLED=true
BUNKER_DE_CLASS="hot"
BUNKER_DE_CRITICALITY="high"
BUNKER_DE_ROLE="storage,vault,offsc,receipts,api-gateway,backup-target"
BUNKER_DE_TYPE="cloud-node"

# Network Configuration
BUNKER_DE_HOSTNAME="bunker-de"
BUNKER_DE_DOMAIN="bunker-de.mesh"
BUNKER_DE_IP_PUBLIC="134.122.64.228"
BUNKER_DE_IP_TAILSCALE="100.97.95.128"  # Tailscale IP
BUNKER_DE_PORT_SSH=22
BUNKER_DE_PORT_API=8080

# Aliases
BUNKER_DE_ALIASES="bunker.mesh,bunker-mesh,bunker-ts,server-node"

# User & Auth
BUNKER_DE_USER="root"
BUNKER_DE_SSH_KEY="~/.ssh/id_ed25519_github"

# Services Running
BUNKER_DE_SERVICES="encrypted-storage,receipts-api,mesh-agent,ssh,dnsmasq-forwarder"
BUNKER_DE_PROVIDES="persistent-storage,receipts,offsc-operations,backup-target"
BUNKER_DE_REQUIRES="dns-from-gamma,pki-from-gamma"

# DNS Configuration
BUNKER_DE_DNS_MODE="forwarder"  # forwards to GAMMA
BUNKER_DE_DNS_UPSTREAM="192.168.0.191:53"
BUNKER_DE_DNS_SERVES=false

# Health Check
BUNKER_DE_HEALTH_CHECK="ping,ssh-connect,api-health,storage-health"
BUNKER_DE_HEALTH_TIMEOUT=60

# Backup/Failover
BUNKER_DE_BACKUP="from-beta"  # cold backup on BETA
BUNKER_DE_FAILOVER_TARGET="beta-restore"  # restore from BETA (slow)
BUNKER_DE_FAILOVER_TIME_CRITICAL="4h"

# Permissions
BUNKER_DE_CAN_SERVE_DNS=false
BUNKER_DE_CAN_SIGN_CERTS=false
BUNKER_DE_CAN_MANAGE_PEERS=false
BUNKER_DE_CAN_COORDINATE_MESH=false

# Tags
BUNKER_DE_TAGS="storage,vault,offsc,hot,cloud,data-critical"

################################################################################

# ============================================================================
# NODE: AKASH-001 ... AKASH-N (Disposable Compute Bursts)
# Role: Stateless Compute, Ephemeral Workloads
# Status: LOW - Can disappear at any time, replaced by new instances
# ============================================================================

# Template for AKASH nodes (instantiate as akash-001, akash-002, etc.)

AKASH_ENABLED=true
AKASH_CLASS="hot"
AKASH_CRITICALITY="low"
AKASH_ROLE="compute,stateless,burst-jobs"
AKASH_TYPE="cloud-node-ephemeral"

# Network Configuration (template - fill in per node)
AKASH_HOSTNAME_TEMPLATE="akash-{index}"
AKASH_DOMAIN_TEMPLATE="akash-{index}.mesh"
AKASH_IP_TEMPLATE="100.64.1.{index}"  # TBD: actual Akash IPs
AKASH_PORT_SSH=22

# Aliases
AKASH_ALIASES_TEMPLATE="akash-{index}.mesh"

# User & Auth
AKASH_USER="root"
AKASH_SSH_KEY="~/.ssh/id_ed25519_github"

# Services Running
AKASH_SERVICES="compute-workload,mesh-agent,ssh,dnsmasq-forwarder"
AKASH_PROVIDES="compute-bursts"
AKASH_REQUIRES="dns-from-gamma,job-assignment-from-gamma"

# DNS Configuration
AKASH_DNS_MODE="forwarder"
AKASH_DNS_UPSTREAM="192.168.0.191:53"
AKASH_DNS_SERVES=false

# Health Check
AKASH_HEALTH_CHECK="ping,ssh-connect,job-status"
AKASH_HEALTH_TIMEOUT=20

# Backup/Failover
AKASH_BACKUP="none"  # stateless, no data to backup
AKASH_FAILOVER_TARGET="new-instance"  # just spin up another
AKASH_FAILOVER_TIME_CRITICAL="none"

# Permissions
AKASH_CAN_SERVE_DNS=false
AKASH_CAN_SIGN_CERTS=false
AKASH_CAN_MANAGE_PEERS=false
AKASH_CAN_COORDINATE_MESH=false

# Tags
AKASH_TAGS="compute,ephemeral,stateless,hot,disposable,burst"

# Example: Create AKASH-001, AKASH-002, AKASH-003
# AKASH_001_HOSTNAME="akash-001"
# AKASH_001_DOMAIN="akash-001.mesh"
# AKASH_001_IP="100.64.1.1"
#
# AKASH_002_HOSTNAME="akash-002"
# AKASH_002_DOMAIN="akash-002.mesh"
# AKASH_002_IP="100.64.1.2"

################################################################################
# COLD NODES (Offline-capable, no authoritative services)
################################################################################

# ============================================================================
# NODE: BETA (Cold Backup, Offline Verification, Dark Runner)
# Role: Cold Storage, Backup, Forensics, Emergency Operations
# Status: NONE - Completely optional, unplugged by default
# ============================================================================

BETA_ENABLED=true
BETA_CLASS="cold"
BETA_CRITICALITY="none"
BETA_ROLE="cold-backup,cold-storage,offline-verify,operator-cold,dark-runner"
BETA_TYPE="cold-node"

# Network Configuration
BETA_HOSTNAME="beta"
BETA_DOMAIN="beta.mesh"
BETA_IP_LAN="192.168.0.236"
BETA_IP_TAILSCALE="none"  # BETA does NOT join mesh network
BETA_PORT_SSH=22

# Aliases
BETA_ALIASES="beta.local,beta.mesh,beta.cold"

# User & Auth
BETA_USER="sovereign"
BETA_SSH_KEY="~/.ssh/id_ed25519_github"

# Services Running
BETA_SERVICES="ssh,local-tools"
BETA_PROVIDES="cold-backup,cold-storage,offline-verification,forensics"
BETA_REQUIRES="none"  # BETA requires NOTHING from other nodes

# DNS Configuration
BETA_DNS_MODE="none"  # BETA does NOT serve DNS
BETA_DNS_SERVES=false  # CRITICAL: BETA never serves authoritative DNS
BETA_JOINS_MESH=false  # BETA joins mesh only when explicitly powered on

# Health Check
BETA_HEALTH_CHECK="ssh-connect"  # only if powered on
BETA_HEALTH_TIMEOUT="none"  # no timeout expected

# Backup/Failover
BETA_BACKUP="provides-cold-backup-to"  # BETA stores backups FROM other nodes
BETA_FAILOVER_TARGET="BETA is NOT a failover target"
BETA_FAILOVER_TIME_CRITICAL="never"

# Permissions
BETA_CAN_SERVE_DNS=false  # CRITICAL: never
BETA_CAN_SIGN_CERTS=false
BETA_CAN_MANAGE_PEERS=false
BETA_CAN_COORDINATE_MESH=false

# Important Constraints
BETA_MUST_NOT_SERVE_DNS=true
BETA_MUST_NOT_BE_AUTHORITATIVE=true
BETA_NO_PERSISTENT_STATE=true
BETA_NO_EXTERNAL_DEPENDENCIES=true
BETA_DOWNTIME_DOES_NOT_AFFECT_MESH=true

# Tags
BETA_TAGS="cold,backup,offline,optional,forensics,no-downtime-impact"

################################################################################
# OPERATOR NODES
################################################################################

# ============================================================================
# NODE: SOVEREIGN-MAC (Operator Console)
# Role: Control plane, Admin terminal, Future operator fallback
# Status: TEMPORARY - Will be replaced by GAMMA or BRICK as operator terminal
# ============================================================================

MAC_ENABLED=true
MAC_CLASS="operator"
MAC_CRITICALITY="medium"
MAC_ROLE="operator,control-plane,admin-terminal"
MAC_TYPE="operator-node"

# Network Configuration
MAC_HOSTNAME="sovereign-mac"
MAC_DOMAIN="sovereign-mac.local"
MAC_IP="192.168.1.x"  # Your Mac's local IP
MAC_PORT_SSH=22

# Aliases
MAC_ALIASES="mac,operator"

# User & Auth
MAC_USER="sovereign"
MAC_SSH_KEY="~/.ssh/id_ed25519_github"

# Services Running
MAC_SERVICES="ssh,mesh-cli"  # Command-line access only
MAC_PROVIDES="operator-access"
MAC_REQUIRES="ssh-to-gamma,ssh-to-all-nodes"

# DNS Configuration
MAC_DNS_MODE="query-gamma"
MAC_DNS_UPSTREAM="192.168.0.191:53"

# Tags
MAC_TAGS="operator,temporary,control-plane,will-retire"

################################################################################
# MESH-WIDE CONFIGURATION
################################################################################

# Default timeouts
DEFAULT_HEALTH_CHECK_INTERVAL="30s"
DEFAULT_HEALTH_CHECK_TIMEOUT="30s"
DEFAULT_CONNECTION_TIMEOUT="10s"
DEFAULT_DNS_QUERY_TIMEOUT="5s"

# DNS Configuration
DNS_DOMAIN=".mesh"
DNS_AUTHORITY="gamma.mesh"
DNS_AUTHORITY_IP="192.168.0.191"
DNS_FORWARDERS="1.1.1.1,9.9.9.9"  # External DNS fallback

# Mesh Network
MESH_NETWORK="192.168.0.0/24,100.64.0.0/10"  # LAN + Tailscale
MESH_MTU=1500

# PKI Configuration
PKI_AUTHORITY="gamma"
PKI_ROOT_CERT="~/.vaultmesh/keys/root-ca.crt"
PKI_INTERMEDIATE="~/.vaultmesh/keys/intermediate-ca.crt"

# Backup Configuration
BACKUP_TARGET="bunker-de"
BACKUP_COLD_TARGET="beta"
BACKUP_ENCRYPTION="aes-256-gcm"
BACKUP_RETENTION="90d"

# Security
REQUIRE_MESH_SIGNATURE=true
REQUIRE_CERTIFICATE_VALIDATION=true
AUDIT_LOG_PATH="/var/log/mesh-audit.log"

################################################################################
# NODE INVENTORY (for quick reference)
################################################################################

# HOT NODES (Always-on)
HOT_NODES="gamma,brick,bunker-de,akash-001,akash-002,akash-003"
HOT_NODE_COUNT=6

# COLD NODES (Offline-capable)
COLD_NODES="beta"
COLD_NODE_COUNT=1

# CRITICAL NODES (no substitute)
CRITICAL_NODES="gamma"
CRITICAL_NODE_COUNT=1

# HIGH-PRIORITY NODES (can be rerouted)
HIGH_NODES="brick,bunker-de"
HIGH_NODE_COUNT=2

# OPTIONAL NODES
OPTIONAL_NODES="beta,akash-001,akash-002,akash-003"

# Total node count
TOTAL_NODES=7

################################################################################
# MESH-WIDE RULES (Non-negotiable)
################################################################################

# Rule 1: DNS Authority
RULE_DNS_AUTHORITY_ONLY_GAMMA=true
# "GAMMA is the sole authoritative nameserver for .mesh domain"
# "No other node may serve authoritative DNS"
# "All other nodes must be configured as forwarders to GAMMA"

# Rule 2: BETA Never Authoritative
RULE_BETA_NEVER_AUTHORITATIVE=true
# "BETA must never serve DNS, even if online"
# "BETA must never be listed in NS records"
# "BETA goes offline without notice; no service should depend on it"

# Rule 3: PKI Centralization
RULE_PKI_ONLY_GAMMA=true
# "GAMMA is sole PKI root"
# "All certificates must be signed by GAMMA"
# "All nodes trust GAMMA's cert chain"

# Rule 4: Graceful Degradation
RULE_MESH_SURVIVES_HOT_NODE_FAILURE=true
# "Loss of any single HOT node (except GAMMA) is recoverable"
# "Mesh continues with GAMMA + 1+ other hot node"
# "No timeout for cold nodes (BETA)"

# Rule 5: Offline Capability
RULE_COLD_NODES_DO_NOT_BREAK_MESH=true
# "BETA can be powered off indefinitely"
# "No service waits for BETA"
# "No DNS query resolves through BETA"

################################################################################
# DEPLOYMENT STATUS
################################################################################

# Node deployment status (update as you bring nodes online)
DEPLOYMENT_STATUS="in-progress"
DEPLOYMENT_DATE="2025-11-28"

GAMMA_DEPLOYED=false
BRICK_DEPLOYED=false
BUNKER_DE_DEPLOYED=false
AKASH_DEPLOYED=false
BETA_DEPLOYED=false

# Post-deployment validation
GAMMA_VALIDATED=false
BRICK_VALIDATED=false
BUNKER_DE_VALIDATED=false
BETA_VALIDATED=false

# DNS readiness
DNS_CONFIGURED=false
DNS_TESTED=false
DNS_AUTHORITATIVE=false

# Mesh readiness
MESH_DAEMON_RUNNING=false
MESH_PEERS_SYNCHRONIZED=false
MESH_VALIDATED=false

################################################################################
# NOTES & DOCUMENTATION
################################################################################

# This file is the single source of truth for mesh peer definitions
# All bootstrap scripts source this file
# All health checks reference this file
# Keep this file in version control
# Update this file when nodes are added/removed/modified

# For more information, see:
# - ~/.vaultmesh/NODE_ROLES.md (node roles and architecture)
# - ~/.vaultmesh/bootstrap-dns-gamma.sh (DNS setup)
# - ~/.vaultmesh/bootstrap-beta.sh (cold-storage setup)
# - ~/.ssh/VAULTMESH_TOPOLOGY.md (SSH topology)

################################################################################
