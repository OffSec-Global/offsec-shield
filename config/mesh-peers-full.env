# mesh-peers-full.env — Complete VaultMesh Federation Configuration
# Generated: 2025-11-28
#
# This file defines ALL mesh nodes and their roles.
# Source this file on the appropriate node before starting services.
#
# Usage:
#   source config/mesh-peers-full.env
#   export OFFSEC_MESH_NODE_ID="shield-gamma"  # Set per-node
#
# ════════════════════════════════════════════════════════════════════════════
#                           NODE REGISTRY
# ════════════════════════════════════════════════════════════════════════════
#
# ┌────────────┬─────────────────┬──────────────────────────────────────────┐
# │ Node       │ Role            │ Status                                   │
# ├────────────┼─────────────────┼──────────────────────────────────────────┤
# │ GAMMA      │ Root/DNS/PKI    │ HOT (always-on)                          │
# │ BRICK      │ Compute/Runner  │ HOT (always-on)                          │
# │ BUNKER-DE  │ Cloud Receipts  │ HOT (always-on)                          │
# │ AKASH-*    │ Disposable      │ EPHEMERAL (on-demand)                    │
# │ BETA       │ Cold Storage    │ COLD (offline-capable)                   │
# └────────────┴─────────────────┴──────────────────────────────────────────┘
#
# ════════════════════════════════════════════════════════════════════════════

# ════════════════════════════════════════════════════════════════════════════
# NETWORK ADDRESSES
# ════════════════════════════════════════════════════════════════════════════

# GAMMA (Primary Root)
export GAMMA_LAN_IP="192.168.0.191"
export GAMMA_TAILSCALE_IP="100.80.246.127"
export GAMMA_WG_IP="10.13.13.1"
export GAMMA_MESH_URL="http://192.168.0.191:9115"
export GAMMA_MESH_URL_TS="http://100.80.246.127:9115"

# BRICK (Local Compute)
export BRICK_LAN_IP="192.168.0.190"
export BRICK_MESH_URL="http://192.168.0.190:9115"

# BUNKER-DE (Cloud Receipts)
export BUNKER_PUBLIC_IP="134.122.64.228"
export BUNKER_MESH_URL="http://134.122.64.228:9115"

# BETA (Cold Storage)
export BETA_LAN_IP="192.168.0.189"
export BETA_MESH_URL="http://192.168.0.189:9115"

# ════════════════════════════════════════════════════════════════════════════
# PUBLIC KEYS (Base64 Ed25519)
# ════════════════════════════════════════════════════════════════════════════
# Generate with: ./ops/generate-mesh-keys.sh <node-name>
# These are PLACEHOLDER values — replace with actual keys!

export GAMMA_PUBKEY="REPLACE_WITH_GAMMA_PUBKEY_BASE64"
export BRICK_PUBKEY="REPLACE_WITH_BRICK_PUBKEY_BASE64"
export BUNKER_PUBKEY="REPLACE_WITH_BUNKER_PUBKEY_BASE64"
export BETA_PUBKEY="REPLACE_WITH_BETA_PUBKEY_BASE64"

# ════════════════════════════════════════════════════════════════════════════
# MESH PEER CONFIGURATIONS (JSON)
# ════════════════════════════════════════════════════════════════════════════

# --- FOR GAMMA (root node sees all) ---
export GAMMA_PEERS='[
  {"id":"shield-brick","url":"'"$BRICK_MESH_URL"'","pubkey":"'"$BRICK_PUBKEY"'","role":"compute","status":"hot"},
  {"id":"shield-bunker","url":"'"$BUNKER_MESH_URL"'","pubkey":"'"$BUNKER_PUBKEY"'","role":"receipts","status":"hot"},
  {"id":"shield-beta","url":"'"$BETA_MESH_URL"'","pubkey":"'"$BETA_PUBKEY"'","role":"cold-storage","status":"cold"}
]'

# --- FOR BRICK (compute node) ---
export BRICK_PEERS='[
  {"id":"shield-gamma","url":"'"$GAMMA_MESH_URL"'","pubkey":"'"$GAMMA_PUBKEY"'","role":"root","status":"hot"},
  {"id":"shield-bunker","url":"'"$BUNKER_MESH_URL"'","pubkey":"'"$BUNKER_PUBKEY"'","role":"receipts","status":"hot"}
]'

# --- FOR BUNKER-DE (cloud receipts) ---
export BUNKER_PEERS='[
  {"id":"shield-gamma","url":"'"$GAMMA_MESH_URL_TS"'","pubkey":"'"$GAMMA_PUBKEY"'","role":"root","status":"hot"},
  {"id":"shield-brick","url":"'"$BRICK_MESH_URL"'","pubkey":"'"$BRICK_PUBKEY"'","role":"compute","status":"hot"}
]'

# --- FOR BETA (cold storage) ---
export BETA_PEERS='[
  {"id":"shield-gamma","url":"'"$GAMMA_MESH_URL"'","pubkey":"'"$GAMMA_PUBKEY"'","role":"root","status":"hot"},
  {"id":"shield-bunker","url":"'"$BUNKER_MESH_URL"'","pubkey":"'"$BUNKER_PUBKEY"'","role":"receipts","status":"hot"}
]'

# --- FOR AKASH RUNNERS (ephemeral) ---
export AKASH_PEERS='[
  {"id":"shield-gamma","url":"'"$GAMMA_MESH_URL_TS"'","pubkey":"'"$GAMMA_PUBKEY"'","role":"root","status":"hot"},
  {"id":"shield-bunker","url":"'"$BUNKER_MESH_URL"'","pubkey":"'"$BUNKER_PUBKEY"'","role":"receipts","status":"hot"}
]'

# ════════════════════════════════════════════════════════════════════════════
# COMMON SETTINGS
# ════════════════════════════════════════════════════════════════════════════

export OFFSEC_MESH_INTERVAL_SECONDS=60
export OFFSEC_MESH_RECEIPTS_LIMIT=20
export OFFSEC_CAP_AUD="offsec-portal"

# ════════════════════════════════════════════════════════════════════════════
# NODE-SPECIFIC CONFIGURATION FUNCTIONS
# ════════════════════════════════════════════════════════════════════════════

configure_gamma() {
    export OFFSEC_MESH_NODE_ID="shield-gamma"
    export OFFSEC_MESH_PRIVKEY_FILE="/home/sovereign/offsec-shield/config/mesh-keys/shield-gamma.key"
    export OFFSEC_MESH_PEERS="$GAMMA_PEERS"
    export OFFSEC_LISTEN="0.0.0.0:9115"
    export OFFSEC_DATA_DIR="/home/sovereign/offsec-shield/apps/portal-ext/data-offsec"
    export OFFSEC_API_URL="http://localhost:9115"
    echo "Configured as GAMMA (root)"
}

configure_brick() {
    export OFFSEC_MESH_NODE_ID="shield-brick"
    export OFFSEC_MESH_PRIVKEY_FILE="/home/sovereign/offsec-shield/config/mesh-keys/shield-brick.key"
    export OFFSEC_MESH_PEERS="$BRICK_PEERS"
    export OFFSEC_LISTEN="0.0.0.0:9115"
    export OFFSEC_DATA_DIR="/home/sovereign/offsec-data"
    export OFFSEC_API_URL="http://localhost:9115"
    echo "Configured as BRICK (compute)"
}

configure_bunker() {
    export OFFSEC_MESH_NODE_ID="shield-bunker"
    export OFFSEC_MESH_PRIVKEY_FILE="/home/sovereign/offsec-config/mesh-keys/shield-bunker.key"
    export OFFSEC_MESH_PEERS="$BUNKER_PEERS"
    export OFFSEC_LISTEN="0.0.0.0:9115"
    export OFFSEC_DATA_DIR="/home/sovereign/offsec-data"
    export OFFSEC_API_URL="http://localhost:9115"
    echo "Configured as BUNKER-DE (cloud receipts)"
}

configure_beta() {
    export OFFSEC_MESH_NODE_ID="shield-beta"
    export OFFSEC_MESH_PRIVKEY_FILE="/home/sovereign/offsec-config/mesh-keys/shield-beta.key"
    export OFFSEC_MESH_PEERS="$BETA_PEERS"
    export OFFSEC_LISTEN="0.0.0.0:9115"
    export OFFSEC_DATA_DIR="/home/sovereign/offsec-data"
    export OFFSEC_API_URL="http://localhost:9115"
    echo "Configured as BETA (cold storage)"
}

configure_akash() {
    local node_num="${1:-001}"
    export OFFSEC_MESH_NODE_ID="shield-akash-${node_num}"
    export OFFSEC_MESH_PRIVKEY_FILE="/data/node.key"
    export OFFSEC_MESH_PEERS="$AKASH_PEERS"
    export OFFSEC_LISTEN="0.0.0.0:9115"
    export OFFSEC_DATA_DIR="/data"
    export OFFSEC_API_URL="http://localhost:9115"
    echo "Configured as AKASH-${node_num} (disposable runner)"
}

# ════════════════════════════════════════════════════════════════════════════
# USAGE
# ════════════════════════════════════════════════════════════════════════════
#
# On GAMMA:
#   source config/mesh-peers-full.env
#   configure_gamma
#   # Then start portal-ext and mesh-daemon
#
# On BRICK:
#   source config/mesh-peers-full.env
#   configure_brick
#
# On BUNKER-DE:
#   source config/mesh-peers-full.env
#   configure_bunker
#
# On BETA (when online):
#   source config/mesh-peers-full.env
#   configure_beta
#
# On AKASH containers:
#   source config/mesh-peers-full.env
#   configure_akash 001  # or 002, 003, etc.
#
# ════════════════════════════════════════════════════════════════════════════

echo "Mesh peers configuration loaded."
echo "Run configure_<node> to set up for a specific node."
echo "Available: configure_gamma, configure_brick, configure_bunker, configure_beta, configure_akash"
