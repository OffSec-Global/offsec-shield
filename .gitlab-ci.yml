stages:
  - ping
  - build

# Smoke test - runs on every push
ping_brick:
  stage: ping
  tags:
    - brick
  image: alpine:latest
  script:
    - echo "ðŸ§± Running on BRICK runner!"
    - hostname
    - cat /etc/os-release | head -3

# Rust build - auto runs after ping
rust_build:
  stage: build
  tags:
    - brick
    - rust
  image: rust:1.83-slim
  cache:
    key: "cargo-${CI_COMMIT_REF_SLUG}"
    paths:
      - target/
      - /usr/local/cargo/registry/
      - /usr/local/cargo/git/
  script:
    - rustc --version
    - cargo --version
    - echo "Rust toolchain ready - add real build commands here"
  artifacts:
    paths:
      - target/release/
    expire_in: 7 days
    when: on_success

# Node build - auto runs after ping
node_build:
  stage: build
  tags:
    - brick
    - nodejs
  image: node:22-alpine
  cache:
    key: "npm-${CI_COMMIT_REF_SLUG}"
    paths:
      - node_modules/
  script:
    - node --version
    - npm --version
    - echo "Node toolchain ready - add real build commands here"
  artifacts:
    paths:
      - dist/
      - .next/
    expire_in: 7 days
    when: on_success
